<% layout("./layouts/boilerplate.ejs") %>

  <body>
    <div class="container p-3 m-2">

      <h1 class="text-3xl m-3">Create New Listing:</h1>
      <form action="/listings" method="post" class="needs-validation" novalidate enctype="multipart/form-data">

        <div>
          <label for="name">Name:</label>
          <input type="text" placeholder="Name" name="listing[name]" id="name"
            class="form-control mb-3 p-1 text-black border-1 border-zinc-900 h-[3rem] rounded-lg" required>
        </div>

        <label for="description">Description:</label>
        <input type="text" placeholder="Description" name="listing[description]" id="description"
          class=" form-control mb-3 h-20 p-1 text-black border-1 border-zinc-900 rounded-lg" required>



        <label for="image">Image:</label>
        <input type="file" placeholder="Image-URL" name="listing[image]" id="image"
          class="form-control mb-3 p-1 text-black border-1 border-zinc-900   rounded-lg" required>

        <div class="flex text-center items-center">
          <label for="price">Price:</label>
          <input type="number" placeholder="Price" name="listing[price]" id="price"
            class="form-control m-3 p-1 w-60 text-black border-1 border-zinc-900 h-[3rem] rounded-lg" required>

          <label for="country">Country:</label>
          <input type="text" list="countries" placeholder="Country" name="listing[country]" id="country"
            class=" form-control m-3 p-1 h-10 text-black border-1 border-zinc-900 h-[3rem] rounded-lg" required>
          <datalist id="countries">
            <option value="Afghanistan">
            <option value="Albania">
            <option value="Algeria">
            <option value="Andorra">
            <option value="Angola">
            <option value="Antigua and Barbuda">
            <option value="Argentina">
            <option value="Armenia">
            <option value="Australia">
            <option value="Austria">
            <option value="Azerbaijan">
            <option value="Bahamas">
            <option value="Bahrain">
            <option value="Bangladesh">
            <option value="Barbados">
            <option value="Belarus">
            <option value="Belgium">
            <option value="Belize">
            <option value="Benin">
            <option value="Bhutan">
            <option value="Bolivia">
            <option value="Bosnia and Herzegovina">
            <option value="Botswana">
            <option value="Brazil">
            <option value="Brunei">
            <option value="Bulgaria">
            <option value="Burkina Faso">
            <option value="Burundi">
            <option value="Cabo Verde">
            <option value="Cambodia">
            <option value="Cameroon">
            <option value="Canada">
            <option value="Central African Republic">
            <option value="Chad">
            <option value="Chile">
            <option value="China">
            <option value="Colombia">
            <option value="Comoros">
            <option value="Congo, Democratic Republic of the">
            <option value="Congo, Republic of the">
            <option value="Costa Rica">
            <option value="Croatia">
            <option value="Cuba">
            <option value="Cyprus">
            <option value="Czech Republic">
            <option value="Denmark">
            <option value="Djibouti">
            <option value="Dominica">
            <option value="Dominican Republic">
            <option value="Ecuador">
            <option value="Egypt">
            <option value="El Salvador">
            <option value="Equatorial Guinea">
            <option value="Eritrea">
            <option value="Estonia">
            <option value="Eswatini">
            <option value="Ethiopia">
            <option value="Fiji">
            <option value="Finland">
            <option value="France">
            <option value="Gabon">
            <option value="Gambia">
            <option value="Georgia">
            <option value="Germany">
            <option value="Ghana">
            <option value="Greece">
            <option value="Grenada">
            <option value="Guatemala">
            <option value="Guinea">
            <option value="Guinea-Bissau">
            <option value="Guyana">
            <option value="Haiti">
            <option value="Honduras">
            <option value="Hungary">
            <option value="Iceland">
            <option value="India">
            <option value="Indonesia">
            <option value="Iran">
            <option value="Iraq">
            <option value="Ireland">
            <option value="Israel">
            <option value="Italy">
            <option value="Jamaica">
            <option value="Japan">
            <option value="Jordan">
            <option value="Kazakhstan">
            <option value="Kenya">
            <option value="Kiribati">
            <option value="Korea, North">
            <option value="Korea, South">
            <option value="Kosovo">
            <option value="Kuwait">
            <option value="Kyrgyzstan">
            <option value="Laos">
            <option value="Latvia">
            <option value="Lebanon">
            <option value="Lesotho">
            <option value="Liberia">
            <option value="Libya">
            <option value="Liechtenstein">
            <option value="Lithuania">
            <option value="Luxembourg">
            <option value="Madagascar">
            <option value="Malawi">
            <option value="Malaysia">
            <option value="Maldives">
            <option value="Mali">
            <option value="Malta">
            <option value="Marshall Islands">
            <option value="Mauritania">
            <option value="Mauritius">
            <option value="Mexico">
            <option value="Micronesia">
            <option value="Moldova">
            <option value="Monaco">
            <option value="Mongolia">
            <option value="Montenegro">
            <option value="Morocco">
            <option value="Mozambique">
            <option value="Myanmar">
            <option value="Namibia">
            <option value="Nauru">
            <option value="Nepal">
            <option value="Netherlands">
            <option value="New Zealand">
            <option value="Nicaragua">
            <option value="Niger">
            <option value="Nigeria">
            <option value="North Macedonia">
            <option value="Norway">
            <option value="Oman">
            <option value="Pakistan">
            <option value="Palau">
            <option value="Palestine">
            <option value="Panama">
            <option value="Papua New Guinea">
            <option value="Paraguay">
            <option value="Peru">
            <option value="Philippines">
            <option value="Poland">
            <option value="Portugal">
            <option value="Qatar">
            <option value="Romania">
            <option value="Russia">
            <option value="Rwanda">
            <option value="Saint Kitts and Nevis">
            <option value="Saint Lucia">
            <option value="Saint Vincent and the Grenadines">
            <option value="Samoa">
            <option value="San Marino">
            <option value="Sao Tome and Principe">
            <option value="Saudi Arabia">
            <option value="Senegal">
            <option value="Serbia">
            <option value="Seychelles">
            <option value="Sierra Leone">
            <option value="Singapore">
            <option value="Slovakia">
            <option value="Slovenia">
            <option value="Solomon Islands">
            <option value="Somalia">
            <option value="South Africa">
            <option value="South Sudan">
            <option value="Spain">
            <option value="Sri Lanka">
            <option value="Sudan">
            <option value="Suriname">
            <option value="Sweden">
            <option value="Switzerland">
            <option value="Syria">
            <option value="Taiwan">
            <option value="Tajikistan">
            <option value="Tanzania">
            <option value="Thailand">
            <option value="Timor-Leste">
            <option value="Togo">
            <option value="Tonga">
            <option value="Trinidad and Tobago">
            <option value="Tunisia">
            <option value="Turkey">
            <option value="Turkmenistan">
            <option value="Tuvalu">
            <option value="Uganda">
            <option value="Ukraine">
            <option value="United Arab Emirates">
            <option value="United Kingdom">
            <option value="United States">
            <option value="Uruguay">
            <option value="Uzbekistan">
            <option value="Vanuatu">
            <option value="Vatican City">
            <option value="Venezuela">
            <option value="Vietnam">
            <option value="Yemen">
            <option value="Zambia">
            <option value="Zimbabwe">
          </datalist>

        </div>


        <label for="location">Location:</label>
        <input type="text" list="tourist-locations" placeholder="Location" name="listing[location]" id="location"
          class="form-control mb-3 p-1 text-black border-1 border-zinc-900 h-[3rem] rounded-lg" required>
        <datalist id="tourist-locations">
          <option value="Eiffel Tower, Paris">
          <option value="Great Wall of China, China">
          <option value="Colosseum, Rome">
          <option value="Statue of Liberty, New York">
          <option value="Machu Picchu, Peru">
          <option value="Christ the Redeemer, Rio de Janeiro">
          <option value="Taj Mahal, India">
          <option value="Grand Canyon, USA">
          <option value="Sydney Opera House, Australia">
          <option value="Santorini, Greece">
          <option value="Great Barrier Reef, Australia">
          <option value="Pyramids of Giza, Egypt">
          <option value="Mount Fuji, Japan">
          <option value="Stonehenge, UK">
          <option value="Niagara Falls, Canada/USA">
          <option value="Petra, Jordan">
          <option value="Disneyland, USA">
          <option value="Louvre Museum, Paris">
          <option value="Acropolis, Athens">
          <option value="Big Ben, London">
          <option value="Angkor Wat, Cambodia">
          <option value="Golden Gate Bridge, San Francisco">
          <option value="Burj Khalifa, Dubai">
          <option value="Times Square, New York">
          <option value="Central Park, New York">
          <option value="Sagrada Familia, Barcelona">
          <option value="Mount Kilimanjaro, Tanzania">
          <option value="Yellowstone National Park, USA">
          <option value="Banff National Park, Canada">
          <option value="Dubai Mall, Dubai">
          <option value="Buckingham Palace, London">
          <option value="Chichen Itza, Mexico">
          <option value="Hagia Sophia, Istanbul">
          <option value="Mount Everest, Nepal/Tibet">
          <option value="Victoria Falls, Zambia/Zimbabwe">
          <option value="Alhambra, Spain">
          <option value="Forbidden City, Beijing">
          <option value="Red Square, Moscow">
          <option value="Kremlin, Moscow">
          <option value="Blue Lagoon, Iceland">
          <option value="Galapagos Islands, Ecuador">
          <option value="Uluru, Australia">
          <option value="Bora Bora, French Polynesia">
          <option value="Hawaii Volcanoes National Park, USA">
          <option value="Serengeti National Park, Tanzania">
          <option value="Cinque Terre, Italy">
          <option value="Matterhorn, Switzerland">
          <option value="Vatican City, Italy">
          <option value="Versailles, France">
          <option value="Prague Castle, Czech Republic">
          <option value="Rio Carnival, Rio de Janeiro">
        </datalist>

        <!-- Property Type -->
        <label for="type">Property Type:</label>
        <select name="listing[type]" id="type" class="form-control mb-3 p-1 text-black border-1 border-zinc-900 rounded-lg" required>
          <option value="Apartment">Apartment</option>
          <option value="House">House</option>
          <option value="Villa">Villa</option>
          <option value="Cabin">Cabin</option>
          <option value="Resort">Resort</option>
        </select>

        <!-- Guests, Bedrooms, Bathrooms -->
        <div class="flex gap-4 mb-3">
          <div>
            <label for="guests">Guests:</label>
            <input type="number" name="listing[guests]" id="guests" class="form-control mb-3 p-1 text-black border-1 border-zinc-900 rounded-lg" required>
          </div>
          <div>
            <label for="bedrooms">Bedrooms:</label>
            <input type="number" name="listing[bedrooms]" id="bedrooms" class="form-control mb-3 p-1 text-black border-1 border-zinc-900 rounded-lg" required>
          </div>
          <div>
            <label for="bathrooms">Bathrooms:</label>
            <input type="number" name="listing[bathrooms]" id="bathrooms" class="form-control mb-3 p-1 text-black border-1 border-zinc-900 rounded-lg" required>
          </div>
        </div>

        <!-- Check-in / Check-out -->
        <div class="flex gap-4 mb-3">
          <div>
            <label for="checkin">Check-in Time:</label>
            <input type="time" name="listing[checkin]" id="checkin" class="form-control mb-3 p-1 text-black border-1 border-zinc-900 rounded-lg" required>
          </div>
          <div>
            <label for="checkout">Check-out Time:</label>
            <input type="time" name="listing[checkout]" id="checkout" class="form-control mb-3 p-1 text-black border-1 border-zinc-900 rounded-lg" required>
          </div>
        </div>

        <!-- Amenities -->
        <label>Amenities:</label>
        <div class="flex flex-wrap gap-4 mb-3 p-1 text-black">
          <label><input type="checkbox" name="listing[amenities][]" value="WiFi"> WiFi</label>
          <label><input type="checkbox" name="listing[amenities][]" value="Parking"> Parking</label>
          <label><input type="checkbox" name="listing[amenities][]" value="Pool"> Pool</label>
          <label><input type="checkbox" name="listing[amenities][]" value="AC"> AC</label>
          <label><input type="checkbox" name="listing[amenities][]" value="Kitchen"> Kitchen</label>
          <label><input type="checkbox" name="listing[amenities][]" value="Pet Friendly"> Pet Friendly</label>
        </div>

      

        <!-- Rules -->
        <label for="rules">House Rules / Notes:</label>
        <textarea name="listing[rules]" id="rules" placeholder="e.g., No smoking, No loud music after 10 PM" rows="3"
          class="form-control mb-3 p-1 text-black border-1 border-zinc-900   rounded-lg"></textarea>


        <button class="m-3 bg-gray-800 text-white p-2 rounded-md hover:bg-zinc-600 " type="submit">Create</button>
      </form>
    </div>
    <script>
      // Example starter JavaScript for disabling form submissions if there are invalid fields
      (() => {
        'use strict'

        // Fetch all the forms we want to apply custom Bootstrap validation styles to
        const forms = document.querySelectorAll('.needs-validation')

        // Loop over them and prevent submission
        Array.from(forms).forEach(form => {
          form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
              event.preventDefault()
              event.stopPropagation()
            }

            form.classList.add('was-validated')
          }, false)
        })
      })()
    </script>
    <script>
  const locationInput = document.getElementById('location');
  const form = document.querySelector('form');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const location = locationInput.value;
    const MAPBOX_TOKEN = '<%= process.env.MAP_TOKEN %>';

    try {
      const res = await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(location)}.json?access_token=${MAPBOX_TOKEN}`);
      const data = await res.json();

      if (data.features && data.features.length > 0) {
        const [lng, lat] = data.features[0].geometry.coordinates;

        const lngInput = document.createElement('input');
        lngInput.type = 'hidden';
        lngInput.name = 'listing[geometry][coordinates][]';
        lngInput.value = lng;

        const latInput = document.createElement('input');
        latInput.type = 'hidden';
        latInput.name = 'listing[geometry][coordinates][]';
        latInput.value = lat;

        form.appendChild(lngInput);
        form.appendChild(latInput);
      }

      form.submit();
    } catch (err) {
      alert('Failed to fetch coordinates. Please check the location.');
      console.error(err);
    }
  });
    </script>
    
  </body>

  </html>